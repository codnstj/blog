---
layout: post
category: aws
---
# RI 인스턴스의 대해서 

## RI 인스턴스란?
RI 란 Reserved Instance 의 약자로 말 그대로 해석하면 Instance 를 예약한다는 뜻 입니다. 이는 일정 기간 동안 Instance 를 예약해서 사용을 하겠다는 일종의 약정 할인과 같은 방식입니다. 옵션에 따라 다르지만 온디맨드 인스턴스에 비해 최대 75% 까지 저렴합니다.

---

## RI 의 사용
예약 인스턴스는 필요에 다라 언제든지 구입하여 사용할 수 있습니다.

## RI 인스턴스 유형

1. 표준(Standard RI)
   - 할인율이 높다.
   - 예약된 기간동안 인스턴스 유형(T2,M5..etc) 변경 불가
   - 예약된 기간동안 인스턴스 크기 변경가능
   - 예를들어 `t2.small` 인스턴스 사용중 같은 계열의 하위 크기 인스턴스인 `t2.micro` 2대로 변경이 가능함. (현재 인스턴스 크기의 하위 인스턴스로만 변경이 가능함)
2. 전환형(Convertible RI)
   - `Standard RI` 와 비교하여 할인율이 좀더 낮지만 인스턴스 유형, 크기에 상관없이 보다 자유롭게 변경이 가능함.

## 결재 옵션 및 기간
- **결재 옵션** : 전체 선결재(All Upfront), 부분 선결재(Partial Upfront), 선결재 없음(No Upfront)
- **기간** : 1년(60s x 60m x 24h x 365d = 31,536,000s), 3년(60s x 60m x 24h x 1095d = 94,608,000s)
- 선결재 비중이 높고 기간이 길수록 할인률이 높아짐
- 선결재 금액은 환불이 되지 않으니 신중하게 생각해야한다.
---
## RI 적용시 주의점
예를들어 `t2.micro` 인스턴스 1년 을 구매하였고 운영중인 `t2.micro` 타입의 온디맨드 인스턴스가 여러개가 있다고 가정해보겠습니다.

결론적으로 1개를 구입했지만 여러개의 `t2.micro` 인스턴스에 골고루 적용이 됩니다.


**예를 들어 설명하자면,**
`t2.micro` 온디맨드 인스턴스 가격이 시간당 $1, RI 적용했을때 $0.5라 가정하겠습니다.
  - 인스턴스 1개를 사용할 경우 RI 적용시 $0.5 과금됩니다.
  - 월 $0.5의 할인이 적용되기 떄문에 그걸 2대에 분산하면 인스턴스당 $0.25 씩 할인이 적용된다 보면 됩니다.

정확히 말해서 인스턴스 1개에 대해 1년 사용하는 기간동안의 할인을 받는것이기 때문에 과금기준 1개월을 놓고 계산해보면 다음과 같습니다.
  - t2.micro 1개월 사용할 경우 720 시간을 사용
  - 2개일 경우 720시간 x 2 = 1440 시간이 된다.
  - RI 는 1개를 구매하였기 떄문에 1440 시간 중 인스턴스 1개분(720시간)에 대해서만 $0.5가 적용된다고 보면 된다.
  - 인스턴스 2개를 사용하므로 최종계산은 ($0.5 x 720시간) + ($1 x 720시간) = $1080 이 됩니다.
---

## 중요한 부분

**RI 적용한 계정이 Consolidated billing 에 묶인  Linked Account 이거나 Master Account 일 경우 연결된 모든 계정에 RI 가 적용된다는 사실**

물론 묶여진 다른 계정에 동일한 타입의 인스턴스가 존재 할 경우 이겠지만 어쨋든 `t2.micro` 인스턴스 사용하는 계정이 있다면 그 계정도 혜택을 보게 됩니다.

예를 들어 A라는 Master Account가 있고 여기에 B, C 라는 이름의 Linked Account가 있고 계정 B에서 RI 를 구매했다고 가정 하겠습니다.

이 상황에서 계정 B의 `t2.micro` 인스턴스에만 RI가 적용되면 좋겠지만 계정 B와 C의 모든 `t2.micro` 인스턴스에 RI가 적용이 되게 됩니다.

**이는 여러가지 이유에서 문제가 될 수 있습니다.**

모든 결재는 계정 A 에서 발생되지만 회사 정책상 또는 다른 어떤 이유에서건 Linked Account 에 대해서 내부적으로 정산을 한다면 문제가 될 수 있습니다.

계정 B에서만 쓰려고 RI를 샀는데 결국 계정 C도 RI 혜택을 보게 되기 때문입니다.

이같은 문제를 해결하기 위해 `AWS BILLING Dashboard > Prefrences` 메뉴의 `RI discount sharing` 기능에서 연결된 Linked Account 들을 RI Discount Sharing Disabled 쪽으로 이동시켜 놓으면 계정들끼리의 공유를 막을수 있습니다.

Credit 도 RI와 마찬가지로 모든 계정에 공유가 되므로 Disabled Credit Sharing 옵션을 체크해 막을 수 있습니다.

> source from 
> [블로그(www.onlab.kr)](https://www.onlab.kr/2018/08/07/aws-ri-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC/),
[aws RI 소개](https://aws.amazon.com/ko/aws-cost-management/reserved-instance-reporting/)